{"version":3,"sources":["../../../src/utilities/getBlobUrl.ts","../../../src/utilities/parseAtUri.ts"],"sourcesContent":["import {\n  type LargeBlob,\n  type LargeImage,\n  type SmallBlob,\n  type SmallImage,\n  type Uri,\n} from \"@/../lex-api/types/app/gainforest/common/defs\";\nimport type { $Typed } from \"@/../lex-api/util\";\nimport type { BlobRefGenerator } from \"@/zod-schemas/blobref\";\nimport { BlobRef } from \"@atproto/api\";\n\nconst getBlobUrl = <T extends string>(\n  did: string,\n  imageData:\n    | string\n    | BlobRef\n    | BlobRefGenerator\n    | $Typed<Uri | SmallImage | LargeImage | SmallBlob | LargeBlob>\n    | Uri\n    | SmallImage\n    | LargeImage\n    | SmallBlob\n    | LargeBlob,\n  pdsUrl: T\n) => {\n  if (typeof imageData === \"string\") {\n    const imageUrl = new URL(imageData);\n    return imageUrl.toString();\n  }\n\n  const isBlobRef =\n    imageData instanceof BlobRef ||\n    (\"ref\" in imageData && \"mimeType\" in imageData && \"size\" in imageData);\n  if (isBlobRef) {\n    const ref = imageData.ref as unknown as { $link?: string } | string;\n    const cid = typeof ref === \"string\" ? ref : (ref?.$link ?? String(ref));\n    const encodedCid = encodeURIComponent(cid);\n    return `${pdsUrl}/xrpc/com.atproto.sync.getBlob?did=${did}&cid=${encodedCid}`;\n  }\n\n  // Handle $Typed cases\n  if (imageData.$type === \"app.gainforest.common.defs#uri\") {\n    const uri = imageData.uri;\n    // TODO: handle other URI types\n    // if (uri.startsWith(\"at://\")) {\n    //   const { did: uriDid, rkey: uriRkey } = parseAtUri(uri);\n    //   return `${PDS_URL}/xrpc/com.atproto.repo.getRecord?did=${uriDid}&rkey=${uriRkey}`;\n    // }\n    return uri;\n  }\n\n  if (\n    imageData.$type === \"app.gainforest.common.defs#smallBlob\" ||\n    imageData.$type === \"app.gainforest.common.defs#largeBlob\"\n  ) {\n    const blob = imageData.blob;\n    return getBlobUrl(did, blob, pdsUrl);\n  }\n\n  if (\n    imageData.$type === \"app.gainforest.common.defs#smallImage\" ||\n    imageData.$type === \"app.gainforest.common.defs#largeImage\"\n  ) {\n    const image = imageData.image;\n    return getBlobUrl(did, image, pdsUrl);\n  }\n\n  if (\"blob\" in imageData) {\n    const blob = imageData.blob;\n    return getBlobUrl(did, blob, pdsUrl);\n  }\n\n  if (\"image\" in imageData) {\n    const image = imageData.image;\n    return getBlobUrl(did, image, pdsUrl);\n  }\n\n  if (\"uri\" in imageData) {\n    const uri = imageData.uri;\n    return uri;\n  }\n\n  // Line for compile time check that all cases are handled. THIS SHOULD NEVER BE REACHED.\n  const imageDataTypeCheck = imageData satisfies never;\n  return imageDataTypeCheck;\n};\n\nexport default getBlobUrl;\n","const parseAtUri = (atUri: string) => {\n  const cleanedAtUri = atUri.replace(\"at://\", \"\");\n  const [did, ...rest] = cleanedAtUri.split(\"/\");\n  let rkey = rest.at(-1) ?? \"\";\n  return { did, rkey };\n};\n\nexport default parseAtUri;\n"],"mappings":";AASA,SAAS,eAAe;AAExB,IAAM,aAAa,CACjB,KACA,WAUA,WACG;AACH,MAAI,OAAO,cAAc,UAAU;AACjC,UAAM,WAAW,IAAI,IAAI,SAAS;AAClC,WAAO,SAAS,SAAS;AAAA,EAC3B;AAEA,QAAM,YACJ,qBAAqB,WACpB,SAAS,aAAa,cAAc,aAAa,UAAU;AAC9D,MAAI,WAAW;AACb,UAAM,MAAM,UAAU;AACtB,UAAM,MAAM,OAAO,QAAQ,WAAW,MAAO,KAAK,SAAS,OAAO,GAAG;AACrE,UAAM,aAAa,mBAAmB,GAAG;AACzC,WAAO,GAAG,MAAM,sCAAsC,GAAG,QAAQ,UAAU;AAAA,EAC7E;AAGA,MAAI,UAAU,UAAU,kCAAkC;AACxD,UAAM,MAAM,UAAU;AAMtB,WAAO;AAAA,EACT;AAEA,MACE,UAAU,UAAU,0CACpB,UAAU,UAAU,wCACpB;AACA,UAAM,OAAO,UAAU;AACvB,WAAO,WAAW,KAAK,MAAM,MAAM;AAAA,EACrC;AAEA,MACE,UAAU,UAAU,2CACpB,UAAU,UAAU,yCACpB;AACA,UAAM,QAAQ,UAAU;AACxB,WAAO,WAAW,KAAK,OAAO,MAAM;AAAA,EACtC;AAEA,MAAI,UAAU,WAAW;AACvB,UAAM,OAAO,UAAU;AACvB,WAAO,WAAW,KAAK,MAAM,MAAM;AAAA,EACrC;AAEA,MAAI,WAAW,WAAW;AACxB,UAAM,QAAQ,UAAU;AACxB,WAAO,WAAW,KAAK,OAAO,MAAM;AAAA,EACtC;AAEA,MAAI,SAAS,WAAW;AACtB,UAAM,MAAM,UAAU;AACtB,WAAO;AAAA,EACT;AAGA,QAAM,qBAAqB;AAC3B,SAAO;AACT;AAEA,IAAO,qBAAQ;;;ACvFf,IAAM,aAAa,CAAC,UAAkB;AACpC,QAAM,eAAe,MAAM,QAAQ,SAAS,EAAE;AAC9C,QAAM,CAAC,KAAK,GAAG,IAAI,IAAI,aAAa,MAAM,GAAG;AAC7C,MAAI,OAAO,KAAK,GAAG,EAAE,KAAK;AAC1B,SAAO,EAAE,KAAK,KAAK;AACrB;AAEA,IAAO,qBAAQ;","names":[]}