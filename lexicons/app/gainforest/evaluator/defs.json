{
  "lexicon": 1,
  "id": "app.gainforest.evaluator.defs",
  "description": "Shared type definitions for decentralized evaluator services. Evaluators attach structured, typed evaluation data to records (a more sophisticated evolution of the labeler pattern).",
  "defs": {
    "subjectRef": {
      "type": "object",
      "description": "Reference to a target record that is being evaluated.",
      "required": ["uri"],
      "properties": {
        "uri": {
          "type": "string",
          "format": "at-uri",
          "description": "AT-URI of the target record."
        },
        "cid": {
          "type": "string",
          "format": "cid",
          "description": "CID pinning the exact version of the target record."
        }
      }
    },
    "methodInfo": {
      "type": "object",
      "description": "Provenance metadata describing the method used to produce an evaluation.",
      "required": ["name"],
      "properties": {
        "name": {
          "type": "string",
          "maxGraphemes": 256,
          "description": "Human-readable name of the method or model (e.g., 'GainForest BioClassifier')."
        },
        "version": {
          "type": "string",
          "maxGraphemes": 64,
          "description": "Version string of the method or model (e.g., '2.1.0')."
        },
        "modelCheckpoint": {
          "type": "string",
          "maxGraphemes": 128,
          "description": "Identifier for the specific model checkpoint used (e.g., date or hash)."
        },
        "references": {
          "type": "array",
          "items": { "type": "string", "format": "uri" },
          "maxLength": 10,
          "description": "URIs to papers, documentation, or repositories describing this method."
        }
      }
    },
    "candidateTaxon": {
      "type": "object",
      "description": "A candidate taxon identification with confidence score and rank.",
      "required": ["scientificName", "confidence", "rank"],
      "properties": {
        "scientificName": {
          "type": "string",
          "maxGraphemes": 512,
          "description": "Full scientific name of the candidate taxon."
        },
        "gbifTaxonKey": {
          "type": "string",
          "maxGraphemes": 64,
          "description": "GBIF backbone taxonomy key for the candidate."
        },
        "confidence": {
          "type": "integer",
          "minimum": 0,
          "maximum": 1000,
          "description": "Confidence score (0-1000, where 1000 = 100.0%)."
        },
        "rank": {
          "type": "integer",
          "minimum": 1,
          "description": "Rank position among candidates (1 = best match)."
        },
        "kingdom": {
          "type": "string",
          "maxGraphemes": 128,
          "description": "Kingdom of the candidate taxon."
        },
        "family": {
          "type": "string",
          "maxGraphemes": 128,
          "description": "Family of the candidate taxon."
        },
        "genus": {
          "type": "string",
          "maxGraphemes": 128,
          "description": "Genus of the candidate taxon."
        }
      }
    },
    "qualityFlag": {
      "type": "object",
      "description": "A single data quality flag indicating an issue with a specific field.",
      "required": ["field", "issue"],
      "properties": {
        "field": {
          "type": "string",
          "maxGraphemes": 64,
          "description": "The field name that has the quality issue."
        },
        "issue": {
          "type": "string",
          "maxGraphemes": 256,
          "description": "Description of the quality issue."
        },
        "severity": {
          "type": "string",
          "maxGraphemes": 64,
          "knownValues": ["error", "warning", "info"],
          "description": "Severity level of the quality issue."
        }
      }
    },
    "derivedMeasurement": {
      "type": "object",
      "description": "A single measurement derived by an evaluator from source data.",
      "required": ["measurementType", "measurementValue"],
      "properties": {
        "measurementType": {
          "type": "string",
          "maxGraphemes": 256,
          "description": "The nature of the measurement (e.g., 'canopy cover', 'NDVI', 'tree height')."
        },
        "measurementValue": {
          "type": "string",
          "maxGraphemes": 1024,
          "description": "The value of the measurement."
        },
        "measurementUnit": {
          "type": "string",
          "maxGraphemes": 64,
          "description": "The units for the measurement value (e.g., '%', 'm', 'kg')."
        },
        "measurementMethod": {
          "type": "string",
          "maxGraphemes": 1024,
          "description": "Description of the method used to obtain the measurement."
        }
      }
    },
    "speciesIdResult": {
      "type": "object",
      "description": "AI or human species recognition result with ranked candidate identifications.",
      "required": ["candidates"],
      "properties": {
        "candidates": {
          "type": "array",
          "items": { "type": "ref", "ref": "#candidateTaxon" },
          "maxLength": 20,
          "description": "Ranked list of candidate species identifications."
        },
        "inputFeature": {
          "type": "string",
          "maxGraphemes": 64,
          "description": "Which feature of the subject record was used as input (e.g., 'mediaEvidence')."
        },
        "remarks": {
          "type": "string",
          "maxGraphemes": 2048,
          "description": "Additional notes about the species identification."
        }
      }
    },
    "dataQualityResult": {
      "type": "object",
      "description": "Data quality assessment result with per-field quality flags.",
      "required": ["flags"],
      "properties": {
        "flags": {
          "type": "array",
          "items": { "type": "ref", "ref": "#qualityFlag" },
          "maxLength": 50,
          "description": "List of quality issues found in the record."
        },
        "completenessScore": {
          "type": "integer",
          "minimum": 0,
          "maximum": 1000,
          "description": "Overall completeness score (0-1000, where 1000 = 100.0%)."
        },
        "remarks": {
          "type": "string",
          "maxGraphemes": 2048,
          "description": "Additional notes about the quality assessment."
        }
      }
    },
    "verificationResult": {
      "type": "object",
      "description": "Expert verification result for a previous identification or evaluation.",
      "required": ["status"],
      "properties": {
        "status": {
          "type": "string",
          "maxGraphemes": 64,
          "knownValues": ["confirmed", "rejected", "uncertain"],
          "description": "Verification status: confirmed, rejected, or uncertain."
        },
        "verifiedBy": {
          "type": "string",
          "maxGraphemes": 256,
          "description": "Name of the person who performed the verification."
        },
        "verifiedByID": {
          "type": "string",
          "maxGraphemes": 256,
          "description": "Persistent identifier (e.g., ORCID) of the verifier."
        },
        "remarks": {
          "type": "string",
          "maxGraphemes": 2048,
          "description": "Notes about the verification decision."
        },
        "suggestedCorrections": {
          "type": "string",
          "maxGraphemes": 5000,
          "description": "Suggested corrections if the original identification was rejected or uncertain."
        }
      }
    },
    "classificationResult": {
      "type": "object",
      "description": "Generic categorical classification result (e.g., conservation priority, habitat type).",
      "required": ["category", "value"],
      "properties": {
        "category": {
          "type": "string",
          "maxGraphemes": 128,
          "description": "The classification category (e.g., 'conservation-priority', 'habitat-type')."
        },
        "value": {
          "type": "string",
          "maxGraphemes": 256,
          "description": "The assigned classification value (e.g., 'critical', 'tropical-rainforest')."
        },
        "remarks": {
          "type": "string",
          "maxGraphemes": 2048,
          "description": "Additional notes about the classification."
        }
      }
    },
    "measurementResult": {
      "type": "object",
      "description": "Derived measurements produced by an evaluator from source data (e.g., remote sensing metrics).",
      "required": ["measurements"],
      "properties": {
        "measurements": {
          "type": "array",
          "items": { "type": "ref", "ref": "#derivedMeasurement" },
          "maxLength": 20,
          "description": "List of derived measurements."
        },
        "remarks": {
          "type": "string",
          "maxGraphemes": 2048,
          "description": "Additional notes about the measurements."
        }
      }
    }
  }
}
